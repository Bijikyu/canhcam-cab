"use strict";function xoaTab(t,e){if(t.preventDefault(),!confirm("Bạn có chắc chắn xóa nó?"))return!1;$(e).parents("li").remove();var a=$(e).attr("data-id");deleteArrayPage($(e).parents("li").attr("data-tab-name")),$("#"+a).remove(),$("#myTab li:first-child > a").trigger("click")}function checkTab(){0<$("#myTab").html().trim().length?($("#myTab").addClass("cnt"),$(".notedcanhcam").hide(),$(".createcanhcam").show(),$(".deview").show(),$(".bleft").show()):($(".notedcanhcam").show(),$(".deview").hide(),$(".createcanhcam").hide(),$("#myTab").removeClass("cnt"),$(".bleft").hide())}function createLeftMenuList(){jQuery.get("/data.json",function(t){var e=t,a=0,n=0,i="";for(var o in e){i=0==n?" show":"";var c=Object.keys(e[o]).length;a=+a+c;var r=document.createElement("div");for(var s in r.id="cc-menu-"+o,r.setAttribute("data-tab-id",taoIdNgauNhien(25)),r.innerHTML='<div class="card"><div class="card-header" id="heading-'+o+'"><h5 class="mb-0"><button class="btn btn-link collapsed d-flex justify-content-between align-items-center" data-toggle="collapse" data-target="#collapse-'+o+'" aria-expanded="true" aria-controls="collapse-'+o+'">'+o.replace("-"," ").toUpperCase()+' <span class="badge badge-secondary">'+c+'</span></button></h5></div><div id="collapse-'+o+'" class="collapse'+i+'" aria-labelledby="heading-'+o+'" data-parent="#accordion"><div class="card-body"><div class="slider-items list-group mainList"></div></div></div>',$("#accordion").append(r),e[o]){var l=e[o][s][0],d=e[o][s][1],m=e[o][s][2],u=e[o][s][3],h='<div class="list-group-item" data-key="'+l+'" data-type="'+d+'"><h5><a href="/templates/index-'+l.replace("/","-")+'.html" target="_blank">'+u+'</a></h5><figure><img src="./img/layout/'+m+'" alt=""></div></figure></div>';if(e[o][s][4]&&e[o][s][4].length)h='<div class="list-group-item" data-height="'+e[o][s][4]+'" data-key="'+l+'" data-type="'+d+'"><h5><a href="/templates/index-'+l.replace("/","-")+'.html" target="_blank">'+u+'</a></h5><figure><img src="./img/layout/'+m+'" alt=""></div></figure></div>';o&&($("#cc-menu-"+o).length&&$("#cc-menu-"+o+" .mainList").append(h),$(".mainList").each(function(t,e){new Sortable.create(e,{group:{name:"mainList",pull:"clone",put:!1},ghostClass:"canhcam-ghost",sort:!1,animation:100,onMove:function(t,e){$("#nav-tabContent").addClass("active")},onClone:function(t){$("#nav-tabContent").addClass("active")},onStart:function(t){$("#nav-tabContent").addClass("active")},onEnd:function(t){$("#nav-tabContent").removeClass("active"),toggleContentReady()}})}))}n++}buildTotal(a)})}function buildTotal(a){jQuery.get("/version.json",function(t){var e=t;$("#version").html(e.version+" "+e.build),$("#accordion").append('<div class="total bg-light p-2 small">Components: <span class="text-info">'+a+'</span><br>Tập tin: <span class="text-info">'+(3*a+9)+'</span><br>Site vừa tạo: <span class="text-info justbuild"></span><br>Phiên bản: <span class="text-info">'+e.version+" "+e.build+"</span></div>")}),jQuery.get("/justbuild.json",function(t){var e=t;$(".justbuild").html("@SITE/"+e.sitename)})}function removeVietnam(t){var e=t.toLowerCase().replace(/\s+/g,"-"),a={"-":'[`~!@#$%^&*()_|+=?;:",.<>/]',a:"[ảàạảãàáâãäåắặẳằẵấầẩẫậâă]",ae:"æ",c:"ç",e:"[èéẹẽẻềệếểễê]",d:"[đ]",i:"[ìíîïị]",n:"ñ",o:"[òóôõöộồốổỗơởợỡờớôơ]",oe:"œ",u:"[ùúûűüủụưửựứừữư]",y:"[ýỳỷỵỹ]"};for(var n in a)e=e.replace(new RegExp(a[n],"gi"),n);return e=e.replace(/[^\w\s]/gi,"-")}function taoIdNgauNhien(t){for(var e="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",n=0;n<t;n++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}function kiemTraTenTrang(t,e){return-1<$.inArray(t,e)}function checkFormDisable(t,e){$("#"+t).prop("checked")?$("#"+e).attr("disabled",!1):$("#"+e).attr("disabled",!0),$("#"+e).prop("checked",!1)}function saveToData(t,e){if(!confirm("Bạn có chắc chắn lưu ngay bây giờ?"))return!1;jQuery.post("/savedata",{dataColor:t,dataJS:e},function(t){"done"===t&&$("#exampleModalCenter").modal("hide")})}function getDataColor(){jQuery.get("/getdata",function(t){var e=JSON.parse(t),a=0;for(var n in e){var i=n,o=e[n],c=document.createElement("div");c.className="col-12 mt-3",c.innerHTML="<h5>Màu Phụ</h5><hr>";var r=document.createElement("div");r.className="col-sm-6 col-lg-3",r.innerHTML='<div class="form-group"><div class="input-group colorpicker-component cppicker"><div class="input-group-prepend"><span class="input-group-text">'+i+'</span></div><input type="text" class="form-control" value="'+o+'"><span class="input-group-addon"><i></i></span></div></div>',4==a&&document.getElementById("maincolor").appendChild(c),document.getElementById("maincolor").appendChild(r),$(".cppicker").colorpicker(),a++}})}function getDataJS(){jQuery.get("/getdatajs",function(t){var e=JSON.parse(t);for(var a in e)"number"==typeof e[a]?$("[data-key='"+a+"']").val(e[a]):e[a]?$("[data-key='"+a+"']").prop("checked",!0):$("[data-key='"+a+"']").prop("checked",!1),0})}function resizeFrame(){$(".ifthumnails").each(function(){var e=this;$(this).removeAttr("style"),$(this).find("iframe").removeAttr("style");var t=$(this).parents(".list-group-item");if(t.attr("data-height")&&t.attr("data-height").length){var a=t.attr("data-height");setTimeout(function(){$(e).css({height:a}),$(e).find("iframe").css({height:a})},1e3)}else setTimeout(function(){var t=$(e).find("iframe").contents().height();$(e).css({height:t+"px"}),$(e).find("iframe").css({height:t+"px"})},1e3)})}function toggleContentReady(){var t=!0;$(".newlist").each(function(){0<$(this).html().trim().length?(t=!1,$(this).addClass("cnt")):$(this).removeClass("cnt")}),t||unSavePage()}function addClickDel(t){$("#edit-"+t).css({cursor:"pointer"}),$("#edit-"+t).click(function(){setTimeout(function(){$("#"+t).focus().click()},100)})}function buildFormAddComponent(){$("#formAddComponent select").html("<option selected disabled>Vui lòng chọn</option>"),$("#formAddComponent")[0].reset(),$("#formAddComponent .textresult").html("..."),jQuery.get("/data.json",function(t){var e="";for(var a in t)if(t.hasOwnProperty(a)){var n=Object.keys(t[a]).length;e+="<option data-comnum="+(n+1)+" data-type="+("header"===a?"header":"footer"===a?"footer":"body")+" data-count="+a.charAt(0)+"-"+(n+1)+" value="+a+">"+a.charAt(0).toUpperCase()+a.slice(1)}$("#formAddComponent select").append(e).on("change",function(t){var e=$("option:selected",this).attr("data-count"),a=$("option:selected",this).attr("data-type"),n=$("option:selected",this).attr("data-comnum");$("#formAddComponent .textresult").html(t.target.value+"/"+e),$("#formAddComponent #comkey").val(e),$("#formAddComponent #commain").val(a),$("#formAddComponent #comnum").val(n),$("#formAddComponent #nameCompo").val(t.target.value.charAt(0).toUpperCase()+t.target.value.slice(1).replace("-"," ")+" "+n)})})}function unSavePage(){$(window).bind("beforeunload",function(){return"Bạn có muốn thoát trang ngay bây giờ?"})}$(function(){addClickDel("projectname"),$('[data-toggle="tooltip"]').tooltip(),$("#projectname").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,e){var a=removeVietnam(e.trim());objectName=a,t.text(a)}}),checkFormDisable("customCheck1","customCheck2"),$("#customCheck1").click(function(){checkFormDisable("customCheck1","customCheck2")}),$("#addComponent").click(function(t){buildFormAddComponent()}),$("#preCreateSite").click(function(t){location.reload()}),$(".togglemenu").click(function(){$("#maincc").toggleClass("active"),$(this).toggleClass("active"),resizeFrame()}),$("#tooglepc").click(function(){$(this).addClass("active"),$("#toogletablet, #tooglemobile").removeClass("active"),$(".maindev").addClass("pc").removeClass("mobile").removeClass("tablet"),resizeFrame()}),$("#tooglemobile").click(function(){$(this).addClass("active"),$("#toogletablet, #tooglepc").removeClass("active"),$(".maindev").addClass("mobile").removeClass("pc").removeClass("tablet"),resizeFrame()}),$("#toogletablet").click(function(){$(this).addClass("active"),$("#tooglemobile, #tooglepc").removeClass("active"),$(".maindev").addClass("tablet").removeClass("mobile").removeClass("pc"),resizeFrame()}),$("#noleft").on("click",".xoatab",function(t){$(this).parents(".nav-link").trigger("click");xoaTab(t,this),checkTab()}),$("#toDoListMain").on("keyup",function(t){if(13===(t.keyCode||t.which))return t.preventDefault(),$(this).find("#buttonListItemMain").trigger("click"),!1}),$("#toDoList").on("keyup keypress",function(t){if(13===(t.keyCode||t.which))return t.preventDefault(),$(this).find("#createPage").trigger("click"),!1}),$("#saveConfig").click(function(){var t,a=[],n=[];$("#settings input[type=text]").each(function(){var t=$(this).val(),e=$(this).parents(".cppicker").find(".input-group-text").html();a.push(e+": "+t)}),$("#jsf input[type=checkbox]").each(function(){var t=$(this).prop("checked"),e=$(this).attr("data-key");n.push('"'+e+'":'+t)}),$("#jsf input[type=text]").each(function(){var t=$(this).val(),e=$(this).attr("data-key");n.push('"'+e+'":'+t)}),t="const CANHCAM_APP = {"+n+"}",saveToData(("$mau: ("+a+")").toString(),t.toString())}),createLeftMenuList(),getDataColor(),getDataJS()}),$(window).resize(function(){resizeFrame()});var data={SETUP:{}},objectName="",pagesLists=["index"],dataSites={color:"main: #2e3192,extra: #ec8b00,front: #659f13,back: #f1c40f,cyan-1: #1abc9c,cyan-2: #16a085,la-1: #2ecc71,la-2: #27ae60,duong-1: #3498db,duong-2: #2980b9,tim-1: #9b59b6,tim-2: #8e44ad,vang-1: #f1c40f,vang-2: #f39c12,cam-1: #e67e22,cam-2: #d35400,do-1: #e74c3c,do-2: #c0392b,den-1: #34495e,den-2: #2c3e50,xam-1: #95a5a6,xam-2: #7f8c8d,hong-1: #ff9ff3,hong-2: #f368e0,trang: #ffffff,den: #000000",js:'"ACTIVE_FIXED_HEADER": false,"HEADER_TRANPARENT": false,"ACTIVE_HEADER_POSITION": 1,"ACTIVE_PADDING_MAIN": true,"ACTIVE_VALIDATOR": true,"ACTIVE_SELECT": true,"ACTIVE_FIXED_FOOTER": true,"ACTIVE_LIST_TO_SELECT": true,"DISPLAY_FOOTER": 600,"ACTIVE_RESPONSIVE": true,"ACTIVE_BACKTOTOP": true,"DISPLAY_BACKTOTOP": 100,"CHANGE_GRID": 991,"CHANGE_GRID_SM": 767,"DEV_MODE": false,"DEV_MODE_GIRD_FULL": false'};function setDefault(){var t,e;t="$mau: ("+dataSites.color+")",e="const CANHCAM_APP = {"+dataSites.js+"}",saveToData(t.toString(),e.toString())}function createPageBuilder(n){data.SETUP[n]=[],$(".newlist").each(function(t,e){var a=new Sortable.create(e,{group:{put:"mainList",pull:!1},onMove:function(t,e){$("#nav-tabContent").addClass("active"),$("#accordion").addClass("remove")},onStart:function(t){$("#nav-tabContent").addClass("active"),$("#accordion").addClass("remove")},onClone:function(t){$("#nav-tabContent").addClass("active"),$("#accordion").addClass("remove")},onRemove:function(t){o()},onAdd:function(t){var e=t.item,a=$(e).attr("data-key").replace("/","-"),n=taoIdNgauNhien(10);if($(e).append('<span class="btn btn-sm btn-danger js-remove" data-id="fg"><i class="fa fa-close"></i></span><div id="'+n+'" class="ifthumnails"><iframe src="./templates/index-'+a+'.html" frameborder="0" onload="this.style.opacity = 1"></iframe></div>'),$(e).attr("data-height")&&$(e).attr("data-height").length){var i=$(e).attr("data-height");setTimeout(function(){$("#"+n).css({height:i}),$("#"+n+" iframe").css({height:i})},1e3)}else setTimeout(function(){var t=$("#"+n+" iframe").contents().height();$("#"+n).css({height:t+"px"}),$("#"+n+" iframe").css({height:t+"px"})},1e3);o()},onUpdate:function(t){var e=t.item;$(e).find("iframe").removeAttr("style"),setTimeout(function(){var t=$(e).find("iframe").contents().height();$(e).find("iframe").css({height:t+"px"})},3e3),o()},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$("#accordion").removeClass("remove"),toggleContentReady()},animation:100,filter:".js-remove",onFilter:function(t){if(!confirm("Bạn có chắc chắn xóa nó?"))return!1;var e=a.closest(t.item);e&&e.parentNode.removeChild(e),o(),toggleContentReady()}});function o(){var t={header:[],body:[],footer:[]};$(e).find(".list-group-item").each(function(){"header"===$(this).attr("data-type")?t.header.push($(this).attr("data-key")):"body"===$(this).attr("data-type")?t.body.push($(this).attr("data-key")):t.footer.push($(this).attr("data-key"))}),data.SETUP[n]=t}$(".mainList").on("dragenter",function(){$(".sortable-ghost",e).remove()})})}function taoTrangIndex(){if(1==pagesLists.length){var t="index";$(".noleft .nav-tabs").append('<li class="nav-item" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i>'+t+".html</a></li>"),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="index" role="tabpanel" aria-labelledby="index-tab"><div class="list-group newlist"></div></div>'),$("#toDoList")[0].reset(),$("#index-tab").trigger("click"),createPageBuilder(t),checkTab()}}function deleteArrayPage(t){var e=pagesLists.indexOf(t);-1<e&&pagesLists.splice(e,1),data.SETUP[t]=null,delete data.SETUP[t]}function changePageName(t,e){var a=pagesLists.indexOf(e);-1<a&&pagesLists.splice(a,1,t),data.SETUP[t]=data.SETUP[e],data.SETUP[e]=null,delete data.SETUP[e]}function getExitsProject(){jQuery.get("/getreadysite",function(t){var i,e=t;$("#typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"getExitsProject",source:(i=e,function(t,e){var a,n;a=[],n=new RegExp(t,"i"),$.each(i,function(t,e){n.test(e)&&a.push(e)}),e(a)})})})}function showTour(){var t=new Tour({steps:[{element:"#accordion",placement:"bottom",title:"Thư viện components",content:"Kéo thả các components dưới đây vago màn hình bên phải."},{element:"#index-tab",placement:"right",title:"Trang & Contents",content:"Bạn có thể thêm/sửa/xóa trang và dàn layout cho trang"},{element:"#toDoList input",placement:"top",title:"Tạo trang mới",content:"Bạn có thể thêm/sửa/xóa trang và dàn layout cho trang"},{element:"#tooglepc",placement:"top",title:"Chế độ test",content:"Chuyển đổi qua lại giữa các chế độ test"},{element:"#nav-tabContent",placement:"top",title:"Layout chính",content:"Màn hình preview hoạt động/hiển thị của components"},{element:"#createSite",placement:"bottom",title:"Tạo Site",content:"Hoàn tất dự án"}]});t.init(),t.start(),$("#retour").click(function(){t.restart()})}$("#buttonListItemMain").click(function(){var e=removeVietnam($("input[name=ListItemMain]").val().trim());jQuery.post("/checksite",{site:e},function(t){return!!e&&("done"!==t?(alert("KHÔNG THÀNH CÔNG! Đã tồn tại dự án với tên này!"),!1):(objectName=e,$("#projectname").html(""+objectName),$("#toDoListMain").hide(),$("#toDoListMain")[0].reset(),$("#toDoList").show(),$("#accordion").addClass("active"),alert("Thêm dự án thành công!, hãy tiếp tục tạo page trên dự án."),taoTrangIndex(),void showTour()))})}),$("#formAddComponent button").click(function(t){var e=new FormData($("#formAddComponent")[0]);return $.ajax({url:"/upload",type:"POST",contentType:!1,processData:!1,cache:!1,data:e,success:function(){alert("Upload hoàn tất"),$("#addComponent").trigger("click"),$("#formAddComponent")[0].reset(),$("#formAddComponent .textresult").html("...")},error:function(){alert("Lỗi khi upload!")}}),!1}),$("#createSite").click(function(t){t.preventDefault();var e=data;if(!confirm("Bạn có chắc chắn tạo site ngay bây giờ?"))return!1;jQuery.post("/createsite",{name:objectName,data:e},function(t){"done"===t&&($("#toDoListMain").show(),$("#toDoList, .deview").hide(),$(".notedcanhcam").show(),$(".notedcanhcam .alert").show(),$(".createcanhcam").hide(),$(".bleft").hide(),$(".enterpro").hide(),$("#myTab").removeClass("cnt"),$("#myTab, #nav-tabContent").html(""),t={SETUP:{}},objectName="",pagesLists=["index"])})}),$("#createPage").click(function(){var t=removeVietnam($("input[name=ListItem]").val().trim());if(kiemTraTenTrang(t,pagesLists))alert("Chưa nhập tên hoặc đã tồn tại trang này!"),$("#toDoList")[0].reset();else{if(!t)return!1;$(".noleft .nav-tabs").append('<li class="nav-item page-tab" data-tab-name="'+t+'" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i><abbr data-original-title="Edit" class="name-tab">'+t+'</abbr>.html<span class="btn btn-sm btn-danger xoatab" data-id="'+t+'"><i class="fa fa-close"></i></span></a></li>'),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="'+t+'" role="tabpanel" aria-labelledby="'+t+'-tab"><div class="list-group newlist"></div></div>'),$("#toDoList")[0].reset(),$("#"+t+"-tab").trigger("click"),createPageBuilder(t),checkTab(),pagesLists.push(t),$("#myTab .page-tab .nav-link .name-tab").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,e){var a=removeVietnam(e.trim());if(kiemTraTenTrang(a,pagesLists))t.text(t.innerText);else{t.text(a);var n=$(t).parents(".nav-item").attr("data-tab-name");$(t).parents(".nav-item").attr("data-tab-name",a),$(t).parents(".nav-link").attr({id:a+"-tab","aria-controls":a,href:"#"+a}),$("#nav-tabContent").find("#"+n).attr({id:a,"aria-labelledby":a+"-tab"}),changePageName(a,n)}}})}}),key.filter=function(t){var e=(t.target||t.srcElement).tagName;return!("SELECT"==e||"TEXTAREA"==e)},key("ctrl+alt+d,⌘+alt+d",function(){return $("#toDoListMain input").focus(),!1}),key("ctrl+alt+e,⌘+alt+e",function(){return $("#toDoList button").click(),$("#toDoListMain button").click(),!1}),key("ctrl+alt+p,⌘+alt+p",function(){return $("#toDoList input").focus(),!1}),key("ctrl+alt+l,⌘+alt+l",function(){return $("#tooglepc").click(),!1}),key("ctrl+alt+m,⌘+alt+m",function(){return $("#tooglemobile").click(),!1}),key("ctrl+alt+t,⌘+alt+t",function(){return $("#toogletablet").click(),!1}),key("ctrl+alt+n,⌘+alt+n",function(){return $(".togglemenu").click(),!1}),getExitsProject();