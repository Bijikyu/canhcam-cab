"use strict";function xoaTab(t,a){if(t.preventDefault(),!confirm("Bạn có chắc chắn xóa nó?"))return!1;$(a).parents("li").remove();var e=$(a).attr("data-id");deleteArrayPage($(a).parents("li").attr("data-tab-name")),$("#"+e).remove(),$("#myTab li:first-child > a").trigger("click")}function checkTab(){0<$("#myTab").html().trim().length?($("#myTab").addClass("cnt"),$(".notedcanhcam").hide(),$(".createcanhcam").show(),$(".deview").show(),$(".bleft").show()):($(".notedcanhcam").show(),$(".deview").hide(),$(".createcanhcam").hide(),$("#myTab").removeClass("cnt"),$(".bleft").hide())}function createLeftMenuList(){jQuery.get("/data.json",function(t){var a=t,e=0;for(var n in a){var i=Object.keys(a[n]).length;e=+e+i;var o=document.createElement("div");for(var s in o.id="cc-menu-"+n,o.setAttribute("data-tab-id",taoIdNgauNhien(25)),o.innerHTML='<div class="card"><div class="card-header" id="heading-'+n+'"><h5 class="mb-0"><button class="btn btn-link collapsed d-flex justify-content-between align-items-center" data-toggle="collapse" data-target="#collapse-'+n+'" aria-expanded="true" aria-controls="collapse-'+n+'">'+n.replace("-"," ").toUpperCase()+' <span class="badge badge-secondary">'+i+'</span></button></h5></div><div id="collapse-'+n+'" class="collapse" aria-labelledby="heading-'+n+'" data-parent="#accordion"><div class="card-body"><div class="slider-items list-group mainList"></div></div></div>',$("#accordion").append(o),a[n]){var c=a[n][s][0],r=a[n][s][1],d=a[n][s][2],l=a[n][s][3],m="",u="";a[n][s][4]&&a[n][s][4].length&&(m='data-height="'+a[n][s][4]+'"'),a[n][s][5]&&a[n][s][5].length&&(u='data-noted="'+a[n][s][5]+'"');var p='<div class="list-group-item" '+m+" "+u+' data-key="'+c+'" data-type="'+r+'"><h5><a href="/templates/index-'+c.replace("/","-")+'.html" target="_blank">'+l+'</a></h5><figure><img src="./img/layout/'+d+'" alt=""></div></figure></div>';n&&($("#cc-menu-"+n).length&&$("#cc-menu-"+n+" .mainList").append(p),$(".mainList").each(function(t,a){new Sortable.create(a,{group:{name:"mainList",pull:"clone",put:!1},ghostClass:"canhcam-ghost",sort:!1,animation:100,onMove:function(t,a){$("#nav-tabContent").addClass("active")},onClone:function(t){$("#nav-tabContent").addClass("active")},onStart:function(t){$("#nav-tabContent").addClass("active")},onEnd:function(t){$("#nav-tabContent").removeClass("active"),toggleContentReady()}})}))}0}buildTotal(e)})}function buildTotal(e){jQuery.get("/version.json",function(t){var a=t;$("#version").html(a.version+" "+a.build),$("#accordion").append('<div class="total p-2 small">S&#x1ED1; th&#xE0;nh ph&#x1EA7;n: <span class="text-info">'+e+'</span><br>T&#x1EAD;p tin: <span class="text-info">'+(3*e+9)+'</span><br>Site vừa tạo: <span class="text-info justbuild"></span><br>Phi&#xEA;n b&#x1EA3;n: <span class="text-info">'+a.version+" "+a.build+'</span><br>Phi&#xEA;n b&#x1EA3;n Bootstrap: <span class="text-info">'+a.bootstrap+'</span><br>T&#xE1;c gi&#x1EA3;: <span class="text-info">B&#x1EA3;o Nguy&#xEA;n</span></div>'),$("#logopage .text-info").html("CAB")}),jQuery.get("/justbuild.json",function(t){var a=t;$(".justbuild").html("@SITE/"+a.sitename)})}function removeVietnam(t){var a=t.toLowerCase().replace(/\s+/g,"-"),e={"-":'[`~!@#$%^&*()_|+=?;:",.<>/]',a:"[ảàạảãàáâãäåắặẳằẵấầẩẫậâă]",ae:"æ",c:"ç",e:"[èéẹẽẻềệếểễê]",d:"[đ]",i:"[ìíîïị]",n:"ñ",o:"[òóôõöộồốổỗơởợỡờớôơ]",oe:"œ",u:"[ùúûűüủụưửựứừữư]",y:"[ýỳỷỵỹ]"};for(var n in e)a=a.replace(new RegExp(e[n],"gi"),n);return a=a.replace(/[^\w\s]/gi,"-")}function taoIdNgauNhien(t){for(var a="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-",n=0;n<t;n++)a+=e.charAt(Math.floor(Math.random()*e.length));return a}function kiemTraTenTrang(t,a){return-1<$.inArray(t,a)}function checkFormDisable(t,a){$("#"+t).prop("checked")?$("#"+a).attr("disabled",!1):$("#"+a).attr("disabled",!0),$("#"+a).prop("checked",!1)}function saveToData(t,a){if(!confirm("Bạn có chắc chắn lưu ngay bây giờ?"))return!1;jQuery.post("/savedata",{dataColor:t,dataJS:a},function(t){"done"===t&&$("#exampleModalCenter").modal("hide")})}function getDataColor(){jQuery.get("/getdata",function(t){var a=JSON.parse(t),e=0;for(var n in a){var i=n,o=a[n],s=document.createElement("div");s.className="col-12 mt-3",s.innerHTML="<h5>Màu Phụ</h5><hr>";var c=document.createElement("div");c.className="col-sm-6 col-lg-3",c.innerHTML='<div class="form-group"><div class="input-group colorpicker-component cppicker"><div class="input-group-prepend"><span class="input-group-text">'+i+'</span></div><input type="text" class="form-control" value="'+o+'"><span class="input-group-addon"><i></i></span></div></div>',4==e&&document.getElementById("maincolor").appendChild(s),document.getElementById("maincolor").appendChild(c),$(".cppicker").colorpicker(),e++}})}function getDataJS(){jQuery.get("/getdatajs",function(t){var a=JSON.parse(t);for(var e in a)"number"==typeof a[e]?$("[data-key='"+e+"']").val(a[e]):a[e]?$("[data-key='"+e+"']").prop("checked",!0):$("[data-key='"+e+"']").prop("checked",!1),0})}function resizeFrame(){$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(".ifthumnails").each(function(){var a=this;$(this).removeAttr("style"),$(this).find("iframe").removeAttr("style");var t=$(this).parents(".list-group-item");if(t.attr("data-height")&&t.attr("data-height").length){var e=t.attr("data-height");setTimeout(function(){$(a).css({height:e}),$(a).find("iframe").css({height:e})},1e3)}else setTimeout(function(){var t=$(a).find("iframe").contents().height();$(a).css({height:t+"px"}),$(a).find("iframe").css({height:t+"px"})},1e3)}),setTimeout(function(){loadingPage()},1e3)}function loadingPage(){$("body").addClass("pace-done").removeClass("pace-running"),$(".pace").addClass("pace-inactive")}function toggleContentReady(){var t=!0;$(".newlist").each(function(){0<$(this).html().trim().length?(t=!1,$(this).addClass("cnt")):$(this).removeClass("cnt")}),t||unSavePage()}function addClickDel(t){$("#edit-"+t).css({cursor:"pointer"}),$("#edit-"+t).click(function(){setTimeout(function(){$("#"+t).focus().click()},100)})}function buildFormAddComponent(){$("#formAddComponent select").html("<option selected disabled>Vui lòng chọn</option>"),$("#formAddComponent")[0].reset(),$("#formAddComponent .textresult").html("..."),jQuery.get("/data.json",function(t){var a="";for(var e in t)if(t.hasOwnProperty(e)){var n=Object.keys(t[e]).length;a+="<option data-comnum="+(n+1)+" data-type="+("header"===e?"header":"footer"===e?"footer":"body")+" data-count="+e.charAt(0)+"-"+(n+1)+" value="+e+">"+e.charAt(0).toUpperCase()+e.slice(1)}$("#formAddComponent select").append(a).on("change",function(t){var a=$("option:selected",this).attr("data-count"),e=$("option:selected",this).attr("data-type"),n=$("option:selected",this).attr("data-comnum");$("#formAddComponent .textresult").html(t.target.value+"/"+a),$("#formAddComponent #comkey").val(a),$("#formAddComponent #commain").val(e),$("#formAddComponent #comnum").val(n),$("#formAddComponent #nameCompo").val(t.target.value.charAt(0).toUpperCase()+t.target.value.slice(1).replace("-"," ")+" "+n)})})}function unSavePage(){$(window).bind("beforeunload",function(){return"Bạn có muốn thoát trang ngay bây giờ?"})}$(function(){addClickDel("projectname"),$('[data-toggle="tooltip"]').tooltip(),$("#projectname").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,a){var e=removeVietnam(a.trim());objectName=e,t.text(e)}}),checkFormDisable("customCheck1","customCheck2"),$("#customCheck1").click(function(){checkFormDisable("customCheck1","customCheck2")}),$("#addComponent").click(function(t){buildFormAddComponent()}),$("#addElements").click(function(t){buildFormAddComponentDAB()}),$("#preCreateSite").click(function(t){location.reload()}),$(".togglemenu").click(function(){$("#maincc").toggleClass("active"),$(this).toggleClass("active"),resizeFrame()}),$("#tooglepc").click(function(){$(this).addClass("active"),$("#toogletablet, #tooglemobile").removeClass("active"),$(".maindev").addClass("pc").removeClass("mobile").removeClass("tablet"),resizeFrame()}),$("#tooglemobile").click(function(){$(this).addClass("active"),$("#toogletablet, #tooglepc").removeClass("active"),$(".maindev").addClass("mobile").removeClass("pc").removeClass("tablet"),resizeFrame()}),$("#toogletablet").click(function(){$(this).addClass("active"),$("#tooglemobile, #tooglepc").removeClass("active"),$(".maindev").addClass("tablet").removeClass("mobile").removeClass("pc"),resizeFrame()}),$("#noleft").on("click",".xoatab",function(t){$(this).parents(".nav-link").trigger("click");xoaTab(t,this),checkTab()}),$("#toDoListMain").on("keyup",function(t){if(13===(t.keyCode||t.which))return t.preventDefault(),$(this).find("#buttonListItemMain").trigger("click"),!1}),$("#toDoList").on("keyup keypress",function(t){if(13===(t.keyCode||t.which))return t.preventDefault(),$(this).find("#createPage").trigger("click"),!1}),$("#saveConfig").click(function(){var t,e=[],n=[];$("#settings input[type=text]").each(function(){var t=$(this).val(),a=$(this).parents(".cppicker").find(".input-group-text").html();e.push(a+": "+t)}),$("#jsf input[type=checkbox]").each(function(){var t=$(this).prop("checked"),a=$(this).attr("data-key");n.push('"'+a+'":'+t)}),$("#jsf input[type=text]").each(function(){var t=$(this).val(),a=$(this).attr("data-key");n.push('"'+a+'":'+t)}),t="const CANHCAM_APP = {"+n+"}",saveToData(("$mau: ("+e+")").toString(),t.toString())}),createLeftMenuList(),getDataColor(),getDataJS()}),$(window).resize(function(){resizeFrame()}),$(document).ready(function(){setTimeout(function(){var t=$(".memory").attr("data-memory").split(";");$("#accordion .total").append('<br>Bộ nhớ sử dụng: <span class="text-info">'+parseInt(t[1]).toFixed(0)+"MB</span>"),$("#accordion .total").append('<br>Platform: <span class="text-info">'+t[3].charAt(0).toUpperCase()+t[3].slice(1)+"</span>"),$("#accordion .total").append('<br>Node: <span class="text-info">v'+t[4]+"</span>"),$("#aboutBox .sn").html($("html").attr("serial-key")),$("#aboutBox .hk").html($("html").attr("hash-key")),$("#aboutBox .lk").html($("body").attr("license-key"))},1e3)});var data={SETUP:{}},modeCAD="cab",objectName="",pagesLists=["index"],dataSites={color:"main: #2e3192,extra: #ec8b00,front: #659f13,back: #f1c40f,cyan-1: #1abc9c,cyan-2: #16a085,la-1: #2ecc71,la-2: #27ae60,duong-1: #3498db,duong-2: #2980b9,tim-1: #9b59b6,tim-2: #8e44ad,vang-1: #f1c40f,vang-2: #f39c12,cam-1: #e67e22,cam-2: #d35400,do-1: #e74c3c,do-2: #c0392b,den-1: #34495e,den-2: #2c3e50,xam-1: #95a5a6,xam-2: #7f8c8d,hong-1: #ff9ff3,hong-2: #f368e0,trang: #ffffff,den: #000000",js:'"ACTIVE_FIXED_HEADER": false,"HEADER_TRANPARENT": false,"ACTIVE_HEADER_POSITION": 1,"ACTIVE_PADDING_MAIN": true,"ACTIVE_VALIDATOR": true,"ACTIVE_SELECT": true,"ACTIVE_FIXED_FOOTER": true,"ACTIVE_LIST_TO_SELECT": true,"DISPLAY_FOOTER": 600,"ACTIVE_RESPONSIVE": true,"ACTIVE_BACKTOTOP": true,"DISPLAY_BACKTOTOP": 100,"CHANGE_GRID": 991,"CHANGE_GRID_SM": 767,"DEV_MODE": false,"DEV_MODE_GIRD_FULL": false'};function setDefault(){var t,a;t="$mau: ("+dataSites.color+")",a="const CANHCAM_APP = {"+dataSites.js+"}",saveToData(t.toString(),a.toString())}function createPageBuilder(n){data.SETUP[n]=[],$(".newlist").each(function(t,a){var e=new Sortable.create(a,{group:{put:"mainList",pull:!1},onMove:function(t,a){$("#nav-tabContent").addClass("active"),$(".accordion").addClass("remove")},onStart:function(t){$("#nav-tabContent").addClass("active"),$(".accordion").addClass("remove")},onClone:function(t){$("#nav-tabContent").addClass("active"),$(".accordion").addClass("remove")},onRemove:function(t){o()},onAdd:function(t){var a=t.item,e=$(a).attr("data-key").replace("/","-"),n=taoIdNgauNhien(10);if($(a).append('<span class="btn btn-sm btn-danger js-remove" data-id="fg"><i class="fa fa-close"></i></span><div id="'+n+'" class="ifthumnails"><iframe src="./templates/index-'+e+'.html" frameborder="0" onload="this.style.opacity = 1"></iframe></div>'),$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(a).attr("data-height")&&$(a).attr("data-height").length){var i=$(a).attr("data-height");setTimeout(function(){$("#"+n).css({height:i}),$("#"+n+" iframe").css({height:i}),loadingPage()},1e3)}else setTimeout(function(){var t=$("#"+n+" iframe").contents().height();$("#"+n).css({height:t+"px"}),$("#"+n+" iframe").css({height:t+"px"}),loadingPage()},1e3);o()},onUpdate:function(t){var a=t.item;if($(a).find("iframe").removeAttr("style"),$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(a).attr("data-height")&&$(a).attr("data-height").length){var e=$(a).attr("data-height");setTimeout(function(){$(a).find("iframe").css({height:e}),loadingPage()},3e3)}else setTimeout(function(){var t=$(a).find("iframe").contents().height();$(a).find("iframe").css({height:t+"px"}),loadingPage()},3e3);o()},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$(".accordion").removeClass("remove"),toggleContentReady()},animation:100,filter:".js-remove",onFilter:function(t){if(!confirm("Bạn có chắc chắn xóa nó?"))return!1;var a=e.closest(t.item);a&&a.parentNode.removeChild(a),o(),toggleContentReady()}});function o(){var t={header:[],body:[],footer:[]};$(a).find(".list-group-item").each(function(){"header"===$(this).attr("data-type")?t.header.push($(this).attr("data-key")):"body"===$(this).attr("data-type")?t.body.push($(this).attr("data-key")):t.footer.push($(this).attr("data-key"))}),data.SETUP[n]=t}$(".mainList").on("dragenter",function(){$(".sortable-ghost",a).remove()})})}function taoTrangIndex(){if(1==pagesLists.length){var t="index";$(".noleft .nav-tabs").append('<li class="nav-item" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i>'+t+".html</a></li>"),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="index" role="tabpanel" aria-labelledby="index-tab"><div class="list-group newlist"></div></div>'),$("#toDoList")[0].reset(),$("#index-tab").trigger("click"),createPageBuilder(t),checkTab()}}function deleteArrayPage(t){var a=pagesLists.indexOf(t);-1<a&&pagesLists.splice(a,1),data.SETUP[t]=null,delete data.SETUP[t]}function changePageName(t,a){var e=pagesLists.indexOf(a);-1<e&&pagesLists.splice(e,1,t),data.SETUP[t]=data.SETUP[a],data.SETUP[a]=null,delete data.SETUP[a]}$("#buttonListItemMain").click(function(){var a=removeVietnam($("input[name=ListItemMain]").val().trim());modeCAD=$("#cab-dab").val(),jQuery.post("/checksite",{site:a},function(t){return!!a&&("done"!==t?(alert("KHÔNG THÀNH CÔNG! Đã tồn tại dự án với tên này!"),!1):(objectName=a,alert("Thêm dự án thành công!, hãy tiếp tục tạo page trên dự án."),$("#projectname").html(""+objectName),$("#toDoListMain").hide(),$("#toDoListMain")[0].reset(),"dab"===modeCAD?toggleDAB():($("#toDoList").show(),$("#accordion").addClass("active"),$("#accordion-dab").hide(),taoTrangIndex()),void showTour()))})}),$("#formAddComponentDAB button").click(function(t){var a=new FormData($("#formAddComponentDAB")[0]);return $.ajax({url:"/upload-dab",type:"POST",contentType:!1,processData:!1,cache:!1,data:a,success:function(){alert("Upload hoàn tất"),$("#ElmModalCenter").modal("hide"),$("#formAddComponentDAB")[0].reset(),$("#formAddComponentDAB .textresult").html("...")},error:function(){alert("Lỗi khi đăng bài!")}}),!1}),$("#formAddComponent button").click(function(t){var a=new FormData($("#formAddComponent")[0]);return $.ajax({url:"/upload",type:"POST",contentType:!1,processData:!1,cache:!1,data:a,success:function(){alert("Upload hoàn tất"),$("#addCompo").modal("hide"),$("#formAddComponent")[0].reset(),$("#formAddComponent .textresult").html("...")},error:function(){alert("Lỗi khi upload!")}}),!1}),$("#createSite").click(function(t){if(t.preventDefault(),"dab"===modeCAD)alert("HEHE");else{if(!(0<$("#nav-tabContent #index .newlist .list-group-item").length))return alert("Bạn chưa có nội dung cho file index"),!1;var a=data;if(!confirm("Bạn có chắc chắn tạo site ngay bây giờ?"))return!1;jQuery.post("/createsite",{name:objectName,data:a},function(t){"done"===t&&($("#toDoListMain").show(),$("#toDoList, .deview").hide(),$(".notedcanhcam").show(),$(".notedcanhcam .alert").show(),$(".createcanhcam").hide(),$(".bleft").hide(),$(".enterpro").hide(),$("#myTab").removeClass("cnt"),$("#myTab, #nav-tabContent").html(""),t={SETUP:{}},objectName="",pagesLists=["index"])})}}),$("#createPage").click(function(){var t=removeVietnam($("input[name=ListItem]").val().trim());if("dab"===modeCAD)checkReadyTabDAB(t);else if(kiemTraTenTrang(t,pagesLists))alert("Chưa nhập tên hoặc đã tồn tại trang này!"),$("#toDoList")[0].reset();else{if(!t)return!1;$(".noleft .nav-tabs").append('<li class="nav-item page-tab" data-tab-name="'+t+'" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i><abbr data-original-title="Edit" class="name-tab">'+t+'</abbr>.html<span class="btn btn-sm btn-danger xoatab" data-id="'+t+'"><i class="fa fa-close"></i></span></a></li>'),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="'+t+'" role="tabpanel" aria-labelledby="'+t+'-tab"><div class="list-group newlist"></div></div>'),$("#toDoList")[0].reset(),$("#"+t+"-tab").trigger("click"),createPageBuilder(t),checkTab(),pagesLists.push(t),$("#myTab .page-tab .nav-link .name-tab").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,a){var e=removeVietnam(a.trim());if(kiemTraTenTrang(e,pagesLists))t.text(t.innerText);else{t.text(e);var n=$(t).parents(".nav-item").attr("data-tab-name");$(t).parents(".nav-item").attr("data-tab-name",e),$(t).parents(".nav-link").attr({id:e+"-tab","aria-controls":e,href:"#"+e}),$("#nav-tabContent").find("#"+n).attr({id:e,"aria-labelledby":e+"-tab"}),changePageName(e,n)}}})}}),document.onkeyup=function(t){if((t=t||window.event).altKey&&t.ctrlKey&&t.shiftKey&&13==t.which)return $("body"),alert("BAO NGUYEN - 0969689893\nEmail: baonguyenyam@gmail.com\nWeb: baonguyenyam.github.io"),!1};var dab={SETUP:{},objectName:"",pagesLists:["index"]};function toggleDAB(){$("#accordion-dab").addClass("active"),$("#accordion, #addComponent, #stCssJS, .notedcanhcam").hide(),$("#toDoList, .bleft, .deview, #addElements").show(),createLeftMenuListDAB(),taoTrangIndexDAB()}function createPageBuilderDAB(t){dab.SETUP[t]=[],$(".frameNewlist").each(function(t,a){})}function checkReadyTabDAB(t){if(kiemTraTenTrang(t,dab.pagesLists))alert("Chưa nhập tên hoặc đã tồn tại trang này!"),$("#toDoList")[0].reset();else{if(!t)return!1;var a=document.createElement("iframe");a.src="/views/iframe.html",a.width="100%",a.className="frameNewlist",a.onload=function(){taoIframe(a)},$(".noleft .nav-tabs").append('<li class="nav-item page-tab" data-tab-name="'+t+'" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i><abbr data-original-title="Edit" class="name-tab">'+t+'</abbr>.html<span class="btn btn-sm btn-danger xoatab" data-id="'+t+'"><i class="fa fa-close"></i></span></a></li>'),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="'+t+'" role="tabpanel" aria-labelledby="'+t+'-tab"></div>'),$("#toDoList")[0].reset(),$("#"+t).html(a),$("#"+t+"-tab").trigger("click"),createPageBuilderDAB(t),checkTab(),dab.pagesLists.push(t),$("#myTab .page-tab .nav-link .name-tab").quickEdit({blur:!1,checkold:!0,space:!1,maxLength:50,showbtn:!1,submit:function(t,a){var e=removeVietnam(a.trim());if(kiemTraTenTrang(e,dab.pagesLists))t.text(t.innerText);else{t.text(e);var n=$(t).parents(".nav-item").attr("data-tab-name");$(t).parents(".nav-item").attr("data-tab-name",e),$(t).parents(".nav-link").attr({id:e+"-tab","aria-controls":e,href:"#"+e}),$("#nav-tabContent").find("#"+n).attr({id:e,"aria-labelledby":e+"-tab"}),changePageName(e,n)}}})}}function turnOnDND(t,n){var i=t.item,a=unescape($(i).attr("data-content")),e=$(i).attr("data-key");$(i).html(a),"gird"===e||"row"===e?($(i).find(".container, .container-fluid").each(function(t,a){var e=taoIdNgauNhien(10);$(this).attr("id","dab-item-"+e),$(i).find(".container").addClass("dab-item-gird").attr("data-title",".container"),$(i).find(".container-fluid").addClass("dab-item-gird").attr("data-title",".container-fluid"),frameChild(n,e),$(this).append('<span class="dab-item-remove btn btn-sm btn-danger js-remove-child" data-id="fg"><i class="fa fa-times"></i></span>')}),$(i).find(".row").each(function(t,a){$(this).find("div").each(function(t,a){var e=taoIdNgauNhien(10);$(this).attr("id","dab-item-"+e),$(this).addClass("dab-item-col").attr("data-title",".col"),frameChild(n,e),$(this).append('<span class="dab-item-remove btn btn-sm btn-danger js-remove-child" data-id="fg"><i class="fa fa-times"></i></span>')})})):$(i).append('<span class="dab-item-remove btn btn-sm btn-danger js-remove" data-id="fg"><i class="fa fa-times"></i></span>')}function frameChild(e,t){var a=e.contentDocument.getElementById("dab-item-"+t),n=new Sortable.create(a,{ghostClass:"canhcam-ghost",group:{name:"chilsList",put:["mainList","chilsList"]},onMove:function(t,a){$("#nav-tabContent").addClass("active"),$(e).contents().find("#listWithHandle").addClass("active"),$(".accordion").addClass("remove")},onStart:function(t){$("#nav-tabContent").addClass("active"),$(e).contents().find("#listWithHandle").addClass("active"),$(".accordion").addClass("remove")},onClone:function(t){$("#nav-tabContent").addClass("active"),$(e).contents().find("#listWithHandle").addClass("active"),$(".accordion").addClass("remove")},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$(e).contents().find("#listWithHandle").removeClass("active"),$(".accordion").removeClass("remove"),toggleContentReadyDAB(e)},onAdd:function(t){toggleContentReadyDAB(e),turnOnDND(t,e)},animation:100,filter:".js-remove-child",onFilter:function(t){if(!confirm("Bạn có chắc chắn xóa nó?"))return!1;var a=n.closest(t.item);$(a).parents(".dab-item").remove(),toggleContentReadyDAB(e)}})}function taoIframe(e){var t=e.contentDocument.getElementById("listWithHandle"),n=new Sortable.create(t,{ghostClass:"canhcam-ghost",group:{name:"chilsList",put:["mainList","chilsList"]},onMove:function(t,a){$("#nav-tabContent").addClass("active"),$(e).contents().find("#listWithHandle").addClass("active"),$(".accordion").addClass("remove")},onStart:function(t){$("#nav-tabContent").addClass("active"),$(e).contents().find("#listWithHandle").addClass("active"),$(".accordion").addClass("remove")},onClone:function(t){$("#nav-tabContent").addClass("active"),$(e).contents().find("#listWithHandle").addClass("active"),$(".accordion").addClass("remove")},onAdd:function(t){toggleContentReadyDAB(e),turnOnDND(t,e)},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$(e).contents().find("#listWithHandle").removeClass("active"),$(".accordion").removeClass("remove"),toggleContentReadyDAB(e)},animation:100,filter:".js-remove",onFilter:function(t){if(!confirm("Bạn có chắc chắn xóa nó?"))return!1;var a=n.closest(t.item);a&&a.parentNode.removeChild(a),toggleContentReadyDAB(e)}});$(".mainList").on("dragenter",function(){$(".sortable-ghost",t).remove()})}function taoTrangIndexDAB(){if(1==dab.pagesLists.length){var t="index",a=document.createElement("iframe");a.src="/views/iframe.html",a.width="100%",a.className="frameNewlist",a.onload=function(){taoIframe(a)},$(".noleft .nav-tabs").append('<li class="nav-item" data-tab-id="'+taoIdNgauNhien(10)+'"><a class="nav-link" id="'+t+'-tab" data-toggle="tab" href="#'+t+'" role="tab" aria-controls="'+t+'" aria-selected="true"><i class="fa fa-file mr-2"></i>'+t+".html</a></li>"),$(".noleft #nav-tabContent").append('<div class="tab-pane fade" id="index" role="tabpanel" aria-labelledby="index-tab"></div>'),$("#toDoList")[0].reset(),$("#index-tab").trigger("click"),$("#"+t).html(a),createPageBuilderDAB(t),checkTab()}}function toggleContentReadyDAB(t){$(".frameNewlist").each(function(t,a){var e=this;$("body").removeClass("pace-done").addClass("pace-running"),$(".pace").removeClass("pace-inactive"),$(this).removeAttr("style"),setTimeout(function(){var t=$(e).contents().height();$(e).css({height:t+"px"}),loadingPage()},1e3)});var a=!0;$(".frameNewlist").each(function(){0<$(this).contents().find("#listWithHandle").html().trim().length?(a=!1,$(this).contents().find("#listWithHandle").addClass("cnt")):$(this).contents().find("#listWithHandle").removeClass("cnt")}),a||unSavePage()}function createLeftMenuListDAB(){jQuery.get("/data-dab.json",function(t){var a=t,e=0,n=0,i="",o="collapsed";for(var s in a){0==n?(i=" show",o=""):(i="",o=" collapsed");var c=Object.keys(a[s]).length;e=+e+c;var r=document.createElement("div");for(var d in r.id="cc-menu-dab-"+s,r.setAttribute("data-tab-id",taoIdNgauNhien(25)),r.innerHTML='<div class="card"><div class="card-header" id="heading-dab-'+s+'"><h5 class="mb-0"><button class="btn btn-link '+o+' d-flex justify-content-between align-items-center" data-toggle="collapse" data-target="#collapse-dab-'+s+'" aria-expanded="true" aria-controls="collapse-dab-'+s+'">'+s.replace("-"," ").toUpperCase()+' <span class="badge badge-secondary">'+c+'</span></button></h5></div><div id="collapse-dab-'+s+'" class="collapse'+i+'" aria-labelledby="heading-dab-'+s+'" data-parent="#accordion-dab"><div class="card-body"><div class="slider-items list-group mainList"></div></div></div>',$("#accordion-dab").append(r),a[s]){var l=a[s][d][0],m=a[s][d][1],u='<div class="dab-item" data-dab="true" data-key='+s+" data-content="+escape(m)+">"+l+"</div>";s&&($("#cc-menu-dab-"+s).length&&$("#cc-menu-dab-"+s+" .mainList").append(u),$(".mainList").each(function(t,a){new Sortable.create(a,{group:{name:"mainList",pull:"clone",put:!1},ghostClass:"canhcam-ghost",sort:!1,animation:100,onMove:function(t,a){$("#nav-tabContent").addClass("active"),$("#nav-tabContent iframe").contents().find("#listWithHandle").addClass("active")},onClone:function(t){$("#nav-tabContent").addClass("active"),$("#nav-tabContent iframe").contents().find("#listWithHandle").addClass("active")},onStart:function(t){$("#nav-tabContent").addClass("active"),$("#nav-tabContent iframe").contents().find("#listWithHandle").addClass("active")},onEnd:function(t){$("#nav-tabContent").removeClass("active"),$("#nav-tabContent iframe").contents().find("#listWithHandle").removeClass("active")}})}))}n++}buildTotalDAB(e)})}function buildTotalDAB(n){jQuery.get("/version.json",function(t){var a=t;$("#version").html(a.version+" "+a.build),$("#accordion-dab").append('<div class="total p-2 small">S&#x1ED1; th&#xE0;nh ph&#x1EA7;n: <span class="text-info">'+n+'</span><br>Phi&#xEA;n b&#x1EA3;n: <span class="text-info">'+a.version+" "+a.build+'</span><br>Phi&#xEA;n b&#x1EA3;n Bootstrap: <span class="text-info">'+a.bootstrap+'</span><br>T&#xE1;c gi&#x1EA3;: <span class="text-info">B&#x1EA3;o Nguy&#xEA;n</span></div>'),$("#logopage .text-success").html("DAB");var e=$(".memory").attr("data-memory").split(";");$("#accordion-dab .total").append('<br>Bộ nhớ sử dụng: <span class="text-info">'+parseInt(e[1]).toFixed(0)+"MB</span>"),$("#accordion-dab .total").append('<br>Platform: <span class="text-info">'+e[3].charAt(0).toUpperCase()+e[3].slice(1)+"</span>"),$("#accordion-dab .total").append('<br>Node: <span class="text-info">v'+e[4]+"</span>")})}function buildFormAddComponentDAB(){$("#formAddComponentDAB select").html("<option selected disabled>Vui lòng chọn</option>"),$("#formAddComponentDAB")[0].reset(),$("#formAddComponentDAB .textresult").html("..."),jQuery.get("/data-dab.json",function(t){var a="";for(var e in t)if(t.hasOwnProperty(e)){var n=Object.keys(t[e]).length;a+="<option data-comnum="+(n+1)+" data-count="+e.charAt(0)+"-"+(n+1)+" value="+e+">"+e.charAt(0).toUpperCase()+e.slice(1)}$("#formAddComponentDAB select").append(a).on("change",function(t){var a=$("option:selected",this).attr("data-count"),e=$("option:selected",this).attr("data-type"),n=$("option:selected",this).attr("data-comnum");$("#formAddComponentDAB .textresult").html(t.target.value+"/"+a),$("#formAddComponentDAB #comkeyElm").val(a),$("#formAddComponentDAB #commainElm").val(e),$("#formAddComponentDAB #comnumElm").val(n),$("#formAddComponentDAB #nameCompoElm").val(t.target.value.charAt(0).toUpperCase()+t.target.value.slice(1).replace("-"," ")+" "+n)})})}function getExitsProject(){jQuery.get("/getreadysite",function(t){var i,a=t;$("#typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"getExitsProject",source:(i=a,function(t,a){var e,n;e=[],n=new RegExp(t,"i"),$.each(i,function(t,a){n.test(a)&&e.push(a)}),a(e)})})})}function showTour(){var t=new Tour({steps:[{element:"#accordion",placement:"bottom",title:"Thư viện components",content:"Kéo thả các components dưới đây vago màn hình bên phải."},{element:"#accordion-dab",placement:"bottom",title:"Thư viện components",content:"Kéo thả các components dưới đây vago màn hình bên phải."},{element:"#index-tab",placement:"right",title:"Trang & Contents",content:"Bạn có thể thêm/sửa/xóa trang và dàn layout cho trang"},{element:"#toDoList input",placement:"top",title:"Tạo trang mới",content:"Bạn có thể thêm/sửa/xóa trang và dàn layout cho trang"},{element:"#tooglepc",placement:"top",title:"Chế độ test",content:"Chuyển đổi qua lại giữa các chế độ test"},{element:"#nav-tabContent",placement:"top",title:"Layout chính",content:"Màn hình preview hoạt động/hiển thị của components"},{element:"#createSite",placement:"bottom",title:"Tạo Site",content:"Hoàn tất dự án"}]});t.init(),t.start(),$("#retour").click(function(){t.restart()})}key.filter=function(t){var a=(t.target||t.srcElement).tagName;return!("SELECT"==a||"TEXTAREA"==a)},key("ctrl+alt+d,⌘+alt+d",function(){return $("#toDoListMain input").focus(),!1}),key("ctrl+alt+e,⌘+alt+e",function(){return $("#toDoList button").click(),$("#toDoListMain button").click(),!1}),key("ctrl+alt+p,⌘+alt+p",function(){return $("#toDoList input").focus(),!1}),key("ctrl+alt+l,⌘+alt+l",function(){return $("#tooglepc").click(),!1}),key("ctrl+alt+m,⌘+alt+m",function(){return $("#tooglemobile").click(),!1}),key("ctrl+alt+t,⌘+alt+t",function(){return $("#toogletablet").click(),!1}),key("ctrl+alt+n,⌘+alt+n",function(){return $(".togglemenu").click(),!1}),getExitsProject();